version: 2

config:
  log_level: INFO
  output_dir: ./outputs
  show_stacktrace: False
  show_graph: False
  parameter_defaults:
    # You can set these values at the command line or leave the defaults
    BASE_DIR: "."


sources:
  epp:
    file: ${INPUT_FILE}
    # the first row in this file is taken to be column names
    header_rows: 1


transformations:
  epp:
    source: $sources.epp
    operations:
      # snake case column names
      - operation: snake_case_columns
      # display result of first operation. only column names should be changed
      - operation: debug
      # use a single operation to create a new column and populate it with the grade level range from "Program Name" column
      - operation: add_columns
        columns:
          grade_level_range: "{%raw%}{{ program_name.split('_')[1] }}{%endraw%}"
      # display result of second operation. you should see a new column "grade_level_range"
      - operation: debug
      # map the column that was just created to valid descriptors
      - operation: map_values
        column: grade_level_range
        map_file: ./seeds/mapping_grade_level_ranges.csv
      # display the mapped column
      - operation: debug


destinations:
  epp:
    # write the transformed educator preparation program data to a JSONL file
    source: $transformations.epp
    template: ${BASE_DIR}/templates/epp.jsont
    extension: jsonl
    linearize: True
