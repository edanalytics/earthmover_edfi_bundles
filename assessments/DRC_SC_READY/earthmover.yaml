config:
  log_level: DEBUG
  output_dir: ${OUTPUT_DIR}
  memory_limit: 1GB
  state_file: ${STATE_FILE}
  show_graph: False


sources:
  sc_ready_input:
    file: ${INPUT_FILE}
    type: sas




transformations:
  scready_student_assessment:
    operations:
      - operation: keep_columns 
        source: $sources.sc_ready_input
        columns: 
          - stateid
          - schoolid
          - elagrade
          - elass
          - elavss
          - elalev 
          - elassread
          - elaslevread
          - elalev1
          - elalev2 
          - elalev3 
          - elalev4 
          - elalev5 
          - elalev6 
          - elalev7
          - elalev8 
          - elalev9 
          - elalev11
          - mathgrade
          - mathss
          - mathvss
          - mathlev
          - mathlev1 
          - mathlev2 
          - mathlev3 
          - mathlev4 
          - mathlev5
      - operation: rename_columns
        source: $transformations.scready_student_assessment
        columns:
          stateid: student_unique_id
      - operation: add_columns
        source: $transformations.scready_student_assessment
        columns:
          school_year:  ${API_YEAR}
          administration_date: {{ ${API_YEAR} | join("-05-15") }}
      # creating a student assessment id based on these columns
      - operation: combine_columns
        source: $transformations.scready_student_assessment
        columns:
          - stateid
        new_column: generated_test_id
        separator: '-'
  scready_student_assessment_ela:
    operations:
      - operations: modify_columns 
        source: $transformations.scready_student_assessment
        columns: 
          mathlev: ''
          mathlev1: ''
          mathlev2: ''
          mathlev3: ''
          mathlev4: ''
          mathlev5: ''
          mathvss: ''
          mathss: ''
      - operation: add_columns 
        source: $transformations.scready_student_assessment_ela
        columns: 
          subject: 'English Language Arts'
          student_grade: elagrade
  scready_student_assessment_math:
    operations:
      - operations: modify_columns 
        source: $transformations.scready_student_assessment
        columns: 
          elalev: ''
          elalev1: ''
          elalev2: ''
          elalev3: ''
          elalev4: ''
          elalev5: ''
          elalev6: ''
          elalev7: ''
          elalev8: ''
          elalev9: ''
          elalev11: ''
          elavss: ''
          elass: ''
      - operation: add_columns 
        source: $transformations.scready_student_assessment_math
        columns: 
          subject: 'Mathematics'
          student_grade: mathgrade
  scready_student_assessment_stacked: 
    operations: 
      - operations: union 
        source: 
          - $tranformations.scready_student_assessment_ela
          - $tranformations.scready_student_assessment_math
     
destinations:
  assessmentReportingMethodDescriptors:
    source: $transformations.reporting_methods
    template: ${BUNDLE_DIR}/templates/assessmentReportingMethodDescriptors.jsont
    extension: jsonl
    linearize: True
  performanceLevelDescriptors:
    source: $sources.performanceLevelDescriptors
    template: ${BUNDLE_DIR}/templates/performanceLevelDescriptors.jsont
    extension: jsonl
    linearize: True
  assessments:
    source: $sources.assessments
    template: ${BUNDLE_DIR}/templates/assessments.jsont
    extension: jsonl
    linearize: True
  objectiveAssessments:
    source: $transformations.objective_assessments
    template: ${BUNDLE_DIR}/templates/objectiveAssessments.jsont
    extension: jsonl
    linearize: True
  studentAssessments:
    source: $transformations.scready_student_assessment
    template: ${BUNDLE_DIR}/templates/studentAssessment.jsont
    extension: jsonl
    linearize: True
