# See accompanying README.md for details about this file.
version: 2

config:
  log_level: INFO
  output_dir: ${OUTPUT_DIR} # this will be a parameter that is passed through from the command line, leave this as-is.
  memory_limit: 1GB
  state_file: ${STATE_FILE}
  show_graph: False
  parameter_defaults:
    STUDENT_ID_NAME: 'edFi_studentUniqueID' # default to the column added by the apply_xwalk package of student ID xwalking feature
    POSSIBLE_STUDENT_ID_COLUMNS: STUDENT_STATE_ID

sources:
  input:
    file: ${INPUT_FILE}
    header_rows: 1
    optional_fields:
      - TXKEA_VOCABULARY_RESULTS__TXKEA_VOCABULARY
      - TXKEA_LETTER_NAMES_RESULTS__TXKEA_LETTER_NAMES
      - TXKEA_SPELLING_RESULTS__TXKEA_SPELLING
      - TXKEA_LITERACY-READING_COMPOSITE_RESULTS__TXKEA_LITERACY-READING_COMPOSITE
      - TXKEA_Letter_Sounds_1
      - TXKEA_Blending_1
      - TXKEA_LANGUAGE_COMPOSITE_RESULTS__TXKEA_LANGUAGE_COMPOSITE
      - TXKEA_Vocabulary_1
      - TXKEA_Listening_Comp_1
      - KEA_LITERACY_SCREENING_SP_RESULTS__KEA_LITERACY_SCREENING_SP
      - TXKEA_VOCABULARY_SP_RESULTS__TXKEA_VOCABULARY_SP
      - TXKEA_LETTER_NAMES_SP_RESULTS__TXKEA_LETTER_NAMES_SP
      - TXKEA_SPELLING_SP_RESULTS__TXKEA_SPELLING_SP
      - TXKEA_LITERACY-READING_COMPOSITE_SP_RESULTS__TXKEA_LITERACY-READING_COMPOSITE_SP
      - KEA_DYSLEXIA_SCREENER_SP_RESULTS__TXKEA_LETTER_SOUNDS_SP
      - TXKEA_Blending_1_Sp
      - TXKEA_LANGUAGE_COMPOSITE_SP_RESULTS__TXKEA_LANGUAGE_COMPOSITE_SP
      - TXKEA_Vocabulary_1_Sp
      - TXKEA_Listening_Comp_1_Sp
      - TXKEA_VOCABULARY_RESULTS__TXKEA_VOCABULARY_DATE
      - TXKEA_VOCABULARY_RESULTS__CP_TXKEA_VOCABULARY
      - TXKEA_VOCABULARY_1_RESULTS__TXKEA_VOCABULARY_TXKEA_VOCABULARY_1
      - TXKEA_VOCABULARY_1_RESULTS__TXKEA_VOCABULARY_TXKEA_VOCABULARY_1_DATE
      - TXKEA_VOCABULARY_1_RESULTS__CP_TXKEA_VOCABULARY_TXKEA_VOCABULARY_1
      - TXKEA_VOCABULARY_2_RESULTS__TXKEA_VOCABULARY_TXKEA_VOCABULARY_2
      - TXKEA_VOCABULARY_2_RESULTS__TXKEA_VOCABULARY_TXKEA_VOCABULARY_2_DATE
      - TXKEA_VOCABULARY_3_RESULTS__TXKEA_VOCABULARY_TXKEA_VOCABULARY_3
      - TXKEA_VOCABULARY_3_RESULTS__TXKEA_VOCABULARY_TXKEA_VOCABULARY_3_DATE
      - TXKEA_LETTER_NAMES_RESULTS__TXKEA_LETTER_NAMES_DATE
      - TXKEA_LETTER_NAMES_RESULTS__CP_TXKEA_LETTER_NAMES
      - TXKEA_SPELLING_RESULTS__TXKEA_SPELLING_DATE
      - TXKEA_SPELLING_RESULTS__CP_TXKEA_SPELLING
      - TXKEA_SPELLING_1_RESULTS__TXKEA_SPELLING_TXKEA_SPELLING_1
      - TXKEA_SPELLING_1_RESULTS__TXKEA_SPELLING_TXKEA_SPELLING_1_DATE
      - TXKEA_SPELLING_1_RESULTS__CP_TXKEA_SPELLING_TXKEA_SPELLING_1
      - TXKEA_SPELLING_2_RESULTS__TXKEA_SPELLING_TXKEA_SPELLING_2
      - TXKEA_SPELLING_2_RESULTS__TXKEA_SPELLING_TXKEA_SPELLING_2_DATE
      - TXKEA_SPELLING_3_RESULTS__TXKEA_SPELLING_TXKEA_SPELLING_3
      - TXKEA_SPELLING_3_RESULTS__TXKEA_SPELLING_TXKEA_SPELLING_3_DATE
      - TXKEA_LISTENING_COMP_RESULTS__TXKEA_LISTENING_COMP
      - TXKEA_LISTENING_COMP_RESULTS__TXKEA_LISTENING_COMP_DATE
      - TXKEA_LISTENING_COMP_RESULTS__CP_TXKEA_LISTENING_COMP
      - TXKEA_LISTENING_COMP_1_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMP_1
      - TXKEA_LISTENING_COMP_1_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMP_1_DATE
      - TXKEA_LISTENING_COMP_1_RESULTS__CP_TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMP_1
      - TXKEA_LISTENING_COMP_2_RECEPTIVE_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMP_2_RECEPTIVE
      - TXKEA_LISTENING_COMP_2_RECEPTIVE_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMP_2_RECEPTIVE_DATE
      - TXKEA_LISTENING_COMP_2_EXPRESSIVE_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMP_2_EXPRESSIVE
      - TXKEA_LISTENING_COMP_2_EXPRESSIVE_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMP_2_EXPRESSIVE_DATE
      - TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE
      - TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_DATE
      - TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE
      - TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE_RESULTS__TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE_DATE
      - KEA_DYSLEXIA_SCREENER_RESULTS__TXKEA_LETTER_SOUNDS
      - TXKEA_LETTER_SOUNDS_RESULTS__TXKEA_LETTER_SOUNDS
      - TXKEA_LETTER_SOUNDS_RESULTS__TXKEA_LETTER_SOUNDS_DATE
      - TXKEA_LETTER_SOUNDS_RESULTS__CP_TXKEA_LETTER_SOUNDS
      - TXKEA_LETTER_SOUNDS_1_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_1
      - TXKEA_LETTER_SOUNDS_1_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_1_DATE
      - TXKEA_LETTER_SOUNDS_1_RESULTS__CP_TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_1
      - TXKEA_LETTER_SOUNDS_2_RECEPTIVE_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_2_RECEPTIVE
      - TXKEA_LETTER_SOUNDS_2_RECEPTIVE_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_2_RECEPTIVE_DATE
      - TXKEA_LETTER_SOUNDS_2_EXPRESSIVE_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_2_EXPRESSIVE
      - TXKEA_LETTER_SOUNDS_2_EXPRESSIVE_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_2_EXPRESSIVE_DATE
      - TXKEA_LETTER_SOUNDS_3_RECEPTIVE_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_3_RECEPTIVE
      - TXKEA_LETTER_SOUNDS_3_RECEPTIVE_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_3_RECEPTIVE_DATE
      - TXKEA_LETTER_SOUNDS_3_EXPRESSIVE_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_3_EXPRESSIVE
      - TXKEA_LETTER_SOUNDS_3_EXPRESSIVE_RESULTS__TXKEA_LETTER_SOUNDS_TXKEA_LETTER_SOUNDS_3_EXPRESSIVE_DATE
      - KEA_DYSLEXIA_SCREENER_RESULTS__TXKEA_BLENDING
      - TXKEA_BLENDING_RESULTS__TXKEA_BLENDING
      - TXKEA_BLENDING_RESULTS__TXKEA_BLENDING_DATE
      - TXKEA_BLENDING_RESULTS__CP_TXKEA_BLENDING
      - TXKEA_BLENDING_1_RESULTS__TXKEA_BLENDING_TXKEA_BLENDING_1
      - TXKEA_BLENDING_1_RESULTS__TXKEA_BLENDING_TXKEA_BLENDING_1_DATE
      - TXKEA_BLENDING_1_RESULTS__CP_TXKEA_BLENDING_TXKEA_BLENDING_1
      - TXKEA_BLENDING_2_RESULTS__TXKEA_BLENDING_TXKEA_BLENDING_2
      - TXKEA_BLENDING_2_RESULTS__TXKEA_BLENDING_TXKEA_BLENDING_2_DATE
      - TXKEA_BLENDING_3_RECEPTIVE_RESULTS__TXKEA_BLENDING_TXKEA_BLENDING_3_RECEPTIVE
      - TXKEA_BLENDING_3_RECEPTIVE_RESULTS__TXKEA_BLENDING_TXKEA_BLENDING_3_RECEPTIVE_DATE
      - TXKEA_BLENDING_3_EXPRESSIVE_RESULTS__TXKEA_BLENDING_TXKEA_BLENDING_3_EXPRESSIVE
      - TXKEA_BLENDING_3_EXPRESSIVE_RESULTS__TXKEA_BLENDING_TXKEA_BLENDING_3_EXPRESSIVE_DATE
      - TXKEA_DECODING_RESULTS__TXKEA_DECODING
      - TXKEA_DECODING_RESULTS__TXKEA_DECODING_DATE
      - TXKEA_DECODING_2_RESULTS__TXKEA_DECODING_TXKEA_DECODING_2
      - TXKEA_DECODING_2_RESULTS__TXKEA_DECODING_TXKEA_DECODING_2_DATE
      - TXKEA_DECODING_3_RESULTS__TXKEA_DECODING_TXKEA_DECODING_3
      - TXKEA_DECODING_3_RESULTS__TXKEA_DECODING_TXKEA_DECODING_3_DATE
      - TXKEA_MATH_RESULTS__TXKEA_MATH
      - TXKEA_MATH_RESULTS__TXKEA_MATH_DATE
      - TXKEA_MATH_RESULTS__CP_TXKEA_MATH
      - TXKEA_MATH_PART_1_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_1
      - TXKEA_MATH_PART_1_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_1_DATE
      - TXKEA_MATH_PART_2_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_2
      - TXKEA_MATH_PART_2_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_2_DATE
      - TXKEA_MATH_PART_1_W2_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_1_W2
      - TXKEA_MATH_PART_1_W2_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_1_W2_DATE
      - TXKEA_MATH_PART_2_W2_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_2_W2
      - TXKEA_MATH_PART_2_W2_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_2_W2_DATE
      - TXKEA_MATH_PART_1_W3_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_1_W3
      - TXKEA_MATH_PART_1_W3_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_1_W3_DATE
      - TXKEA_MATH_PART_2_W3_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_2_W3
      - TXKEA_MATH_PART_2_W3_RESULTS__TXKEA_MATH_TXKEA_MATH_PART_2_W3_DATE
      - TXKEA_SCIENCE_RESULTS__TXKEA_SCIENCE
      - TXKEA_SCIENCE_RESULTS__TXKEA_SCIENCE_DATE
      - TXKEA_SCIENCE_RESULTS__CP_TXKEA_SCIENCE
      - TXKEA_SCIENCE_1_RESULTS__TXKEA_SCIENCE_TXKEA_SCIENCE_1
      - TXKEA_SCIENCE_1_RESULTS__TXKEA_SCIENCE_TXKEA_SCIENCE_1_DATE
      - TXKEA_SCIENCE_1_RESULTS__CP_TXKEA_SCIENCE_TXKEA_SCIENCE_1
      - TXKEA_SCIENCE_2_RESULTS__TXKEA_SCIENCE_TXKEA_SCIENCE_2
      - TXKEA_SCIENCE_2_RESULTS__TXKEA_SCIENCE_TXKEA_SCIENCE_2_DATE
      - TXKEA_SCIENCE_3_RESULTS__TXKEA_SCIENCE_TXKEA_SCIENCE_3
      - TXKEA_SCIENCE_3_RESULTS__TXKEA_SCIENCE_TXKEA_SCIENCE_3_DATE
      - TXKEA_SOCIAL_EMOTIONAL_RESULTS__TXKEA_SOCIAL_EMOTIONAL
      - TXKEA_SOCIAL_EMOTIONAL_RESULTS__TXKEA_SOCIAL_EMOTIONAL_DATE
      - TXKEA_SOCIAL_EMOTIONAL_RESULTS__CP_TXKEA_SOCIAL_EMOTIONAL
      - TXKEA_EMOTIONAL_MANAGEMENT_RESULTS__TXKEA_EMOTIONAL_MANAGEMENT
      - TXKEA_EMOTIONAL_MANAGEMENT_RESULTS__TXKEA_EMOTIONAL_MANAGEMENT_DATE
      - TXKEA_EMOTIONAL_MANAGEMENT_RESULTS__CP_TXKEA_EMOTIONAL_MANAGEMENT
      - TXKEA_WORKING_MEMORY_RESULTS__TXKEA_WORKING_MEMORY
      - TXKEA_WORKING_MEMORY_RESULTS__TXKEA_WORKING_MEMORY_DATE
      - TXKEA_WORKING_MEMORY_RESULTS__CP_TXKEA_WORKING_MEMORY
      - TXKEA_INHIBITION_RESULTS__TXKEA_INHIBITION
      - TXKEA_INHIBITION_RESULTS__TXKEA_INHIBITION_DATE
      - TXKEA_INHIBITION_RESULTS__CP_TXKEA_INHIBITION
      - TXKEA_ATTENTION_RESULTS__TXKEA_ATTENTION
      - TXKEA_ATTENTION_RESULTS__TXKEA_ATTENTION_DATE
      - TXKEA_ATTENTION_RESULTS__CP_TXKEA_ATTENTION
      - TXKEA_ACADEMIC_MOTOR_RESULTS__TXKEA_ACADEMIC_MOTOR
      - TXKEA_ACADEMIC_MOTOR_RESULTS__TXKEA_ACADEMIC_MOTOR_DATE
      - TXKEA_ACADEMIC_MOTOR_RESULTS__CP_TXKEA_ACADEMIC_MOTOR
      - TXKEA_EN_ADMIN_MODE_RESULTS__TXKEA_EN_ADMIN_MODE
      - TXKEA_EN_ADMIN_MODE_RESULTS__TXKEA_EN_ADMIN_MODE_DATE
      - TXKEA_VOCABULARY_SP_RESULTS__TXKEA_VOCABULARY_SP_DATE
      - TXKEA_VOCABULARY_SP_RESULTS__CP_TXKEA_VOCABULARY_SP
      - TXKEA_VOCABULARY_1_SP_RESULTS__TXKEA_VOCABULARY_SP_TXKEA_VOCABULARY_1_SP
      - TXKEA_VOCABULARY_1_SP_RESULTS__TXKEA_VOCABULARY_SP_TXKEA_VOCABULARY_1_SP_DATE
      - TXKEA_VOCABULARY_1_SP_RESULTS__CP_TXKEA_VOCABULARY_SP_TXKEA_VOCABULARY_1_SP
      - TXKEA_VOCABULARY_2_SP_RESULTS__TXKEA_VOCABULARY_SP_TXKEA_VOCABULARY_2_SP
      - TXKEA_VOCABULARY_2_SP_RESULTS__TXKEA_VOCABULARY_SP_TXKEA_VOCABULARY_2_SP_DATE
      - TXKEA_VOCABULARY_3_SP_RESULTS__TXKEA_VOCABULARY_SP_TXKEA_VOCABULARY_3_SP
      - TXKEA_VOCABULARY_3_SP_RESULTS__TXKEA_VOCABULARY_SP_TXKEA_VOCABULARY_3_SP_DATE
      - TXKEA_LETTER_NAMES_SP_RESULTS__TXKEA_LETTER_NAMES_SP_DATE
      - TXKEA_LETTER_NAMES_SP_RESULTS__CP_TXKEA_LETTER_NAMES_SP
      - TXKEA_SPELLING_SP_RESULTS__TXKEA_SPELLING_SP_DATE
      - TXKEA_SPELLING_SP_RESULTS__CP_TXKEA_SPELLING_SP
      - TXKEA_SPELLING_1_SP_RESULTS__TXKEA_SPELLING_SP_TXKEA_SPELLING_1_SP
      - TXKEA_SPELLING_1_SP_RESULTS__TXKEA_SPELLING_SP_TXKEA_SPELLING_1_SP_DATE
      - TXKEA_SPELLING_1_SP_RESULTS__CP_TXKEA_SPELLING_SP_TXKEA_SPELLING_1_SP
      - TXKEA_SPELLING_2_SP_RESULTS__TXKEA_SPELLING_SP_TXKEA_SPELLING_2_SP
      - TXKEA_SPELLING_2_SP_RESULTS__TXKEA_SPELLING_SP_TXKEA_SPELLING_2_SP_DATE
      - TXKEA_SPELLING_3_SP_RESULTS__TXKEA_SPELLING_SP_TXKEA_SPELLING_3_SP
      - TXKEA_SPELLING_3_SP_RESULTS__TXKEA_SPELLING_SP_TXKEA_SPELLING_3_SP_DATE
      - TXKEA_LISTENING_COMP_SP_RESULTS__TXKEA_LISTENING_COMP_SP
      - TXKEA_LISTENING_COMP_SP_RESULTS__TXKEA_LISTENING_COMP_SP_DATE
      - TXKEA_LISTENING_COMP_SP_RESULTS__CP_TXKEA_LISTENING_COMP_SP
      - TXKEA_LISTENING_COMP_1_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMP_1_SP
      - TXKEA_LISTENING_COMP_1_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMP_1_SP_DATE
      - TXKEA_LISTENING_COMP_1_SP_RESULTS__CP_TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMP_1_SP
      - TXKEA_LISTENING_COMP_2_RECEPTIVE_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMP_2_RECEPTIVE_SP
      - TXKEA_LISTENING_COMP_2_RECEPTIVE_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMP_2_RECEPTIVE_SP_DATE
      - TXKEA_LISTENING_COMP_2_EXPRESSIVE_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMP_2_EXPRESSIVE_SP
      - TXKEA_LISTENING_COMP_2_EXPRESSIVE_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMP_2_EXPRESSIVE_SP_DATE
      - TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_SP
      - TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_SP_DATE
      - TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE_SP
      - TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE_SP_RESULTS__TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE_SP_DATE
      - TXKEA_LETTER_SOUNDS_SP_RESULTS__TXKEA_LETTER_SOUNDS_SP
      - TXKEA_LETTER_SOUNDS_SP_RESULTS__TXKEA_LETTER_SOUNDS_SP_DATE
      - TXKEA_LETTER_SOUNDS_SP_RESULTS__CP_TXKEA_LETTER_SOUNDS_SP
      - KEA_DYSLEXIA_SCREENER_SP_RESULTS__TXKEA_BLENDING_SP
      - TXKEA_BLENDING_SP_RESULTS__TXKEA_BLENDING_SP
      - TXKEA_BLENDING_SP_RESULTS__TXKEA_BLENDING_SP_DATE
      - TXKEA_BLENDING_SP_RESULTS__CP_TXKEA_BLENDING_SP
      - TXKEA_BLENDING_1_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_1_SP
      - TXKEA_BLENDING_1_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_1_SP_DATE
      - TXKEA_BLENDING_1_SP_RESULTS__CP_TXKEA_BLENDING_SP_TXKEA_BLENDING_1_SP
      - TXKEA_BLENDING_2_RECEPTIVE_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_2_RECEPTIVE_SP
      - TXKEA_BLENDING_2_RECEPTIVE_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_2_RECEPTIVE_SP_DATE
      - TXKEA_BLENDING_2_EXPRESSIVE_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_2_EXPRESSIVE_SP
      - TXKEA_BLENDING_2_EXPRESSIVE_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_2_EXPRESSIVE_SP_DATE
      - TXKEA_BLENDING_3_RECEPTIVE_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_3_RECEPTIVE_SP
      - TXKEA_BLENDING_3_RECEPTIVE_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_3_RECEPTIVE_SP_DATE
      - TXKEA_BLENDING_3_EXPRESSIVE_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_3_EXPRESSIVE_SP
      - TXKEA_BLENDING_3_EXPRESSIVE_SP_RESULTS__TXKEA_BLENDING_SP_TXKEA_BLENDING_3_EXPRESSIVE_SP_DATE
      - TXKEA_DECODING_SP_RESULTS__TXKEA_DECODING_SP
      - TXKEA_DECODING_SP_RESULTS__TXKEA_DECODING_SP_DATE
      - TXKEA_DECODING_2_SP_RESULTS__TXKEA_DECODING_SP_TXKEA_DECODING_2_SP
      - TXKEA_DECODING_2_SP_RESULTS__TXKEA_DECODING_SP_TXKEA_DECODING_2_SP_DATE
      - TXKEA_DECODING_3_SP_RESULTS__TXKEA_DECODING_SP_TXKEA_DECODING_3_SP
      - TXKEA_DECODING_3_SP_RESULTS__TXKEA_DECODING_SP_TXKEA_DECODING_3_SP_DATE
      - TXKEA_MATH_SP_RESULTS__TXKEA_MATH_SP
      - TXKEA_MATH_SP_RESULTS__TXKEA_MATH_SP_DATE
      - TXKEA_MATH_SP_RESULTS__CP_TXKEA_MATH_SP
      - TXKEA_MATH_PART_1_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_1_SP
      - TXKEA_MATH_PART_1_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_1_SP_DATE
      - TXKEA_MATH_PART_2_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_2_SP
      - TXKEA_MATH_PART_2_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_2_SP_DATE
      - TXKEA_MATH_PART_1_W2_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_1_W2_SP
      - TXKEA_MATH_PART_1_W2_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_1_W2_SP_DATE
      - TXKEA_MATH_PART_2_W2_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_2_W2_SP
      - TXKEA_MATH_PART_2_W2_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_2_W2_SP_DATE
      - TXKEA_MATH_PART_1_W3_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_1_W3_SP
      - TXKEA_MATH_PART_1_W3_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_1_W3_SP_DATE
      - TXKEA_MATH_PART_2_W3_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_2_W3_SP
      - TXKEA_MATH_PART_2_W3_SP_RESULTS__TXKEA_MATH_SP_TXKEA_MATH_PART_2_W3_SP_DATE
      - TXKEA_SCIENCE_SP_RESULTS__TXKEA_SCIENCE_SP
      - TXKEA_SCIENCE_SP_RESULTS__TXKEA_SCIENCE_SP_DATE
      - TXKEA_SCIENCE_SP_RESULTS__CP_TXKEA_SCIENCE_SP
      - TXKEA_SCIENCE_1_SP_RESULTS__TXKEA_SCIENCE_SP_TXKEA_SCIENCE_1_SP
      - TXKEA_SCIENCE_1_SP_RESULTS__TXKEA_SCIENCE_SP_TXKEA_SCIENCE_1_SP_DATE
      - TXKEA_SCIENCE_1_SP_RESULTS__CP_TXKEA_SCIENCE_SP_TXKEA_SCIENCE_1_SP
      - TXKEA_SCIENCE_SP_2_RESULTS__TXKEA_SCIENCE_SP_TXKEA_SCIENCE_SP_2
      - TXKEA_SCIENCE_SP_2_RESULTS__TXKEA_SCIENCE_SP_TXKEA_SCIENCE_SP_2_DATE
      - TXKEA_SCIENCE_SP_3_RESULTS__TXKEA_SCIENCE_SP_TXKEA_SCIENCE_SP_3
      - TXKEA_SCIENCE_SP_3_RESULTS__TXKEA_SCIENCE_SP_TXKEA_SCIENCE_SP_3_DATE
      - TXKEA_SOCIAL_EMOTIONAL_SP_RESULTS__TXKEA_SOCIAL_EMOTIONAL_SP
      - TXKEA_SOCIAL_EMOTIONAL_SP_RESULTS__TXKEA_SOCIAL_EMOTIONAL_SP_DATE
      - TXKEA_SOCIAL_EMOTIONAL_SP_RESULTS__CP_TXKEA_SOCIAL_EMOTIONAL_SP
      - TXKEA_EMOTIONAL_MANAGEMENT_SP_RESULTS__TXKEA_EMOTIONAL_MANAGEMENT_SP
      - TXKEA_EMOTIONAL_MANAGEMENT_SP_RESULTS__TXKEA_EMOTIONAL_MANAGEMENT_SP_DATE
      - TXKEA_EMOTIONAL_MANAGEMENT_SP_RESULTS__CP_TXKEA_EMOTIONAL_MANAGEMENT_SP
      - TXKEA_WORKING_MEMORY_SP_RESULTS__TXKEA_WORKING_MEMORY_SP
      - TXKEA_WORKING_MEMORY_SP_RESULTS__TXKEA_WORKING_MEMORY_SP_DATE
      - TXKEA_WORKING_MEMORY_SP_RESULTS__CP_TXKEA_WORKING_MEMORY_SP
      - TXKEA_INHIBITION_SP_RESULTS__TXKEA_INHIBITION_SP
      - TXKEA_INHIBITION_SP_RESULTS__TXKEA_INHIBITION_SP_DATE
      - TXKEA_INHIBITION_SP_RESULTS__CP_TXKEA_INHIBITION_SP
      - TXKEA_ATTENTION_SP_RESULTS__TXKEA_ATTENTION_SP
      - TXKEA_ATTENTION_SP_RESULTS__TXKEA_ATTENTION_SP_DATE
      - TXKEA_ATTENTION_SP_RESULTS__CP_TXKEA_ATTENTION_SP
      - TXKEA_ACADEMIC_MOTOR_SP_RESULTS__TXKEA_ACADEMIC_MOTOR_SP
      - TXKEA_ACADEMIC_MOTOR_SP_RESULTS__TXKEA_ACADEMIC_MOTOR_SP_DATE
      - TXKEA_ACADEMIC_MOTOR_SP_RESULTS__CP_TXKEA_ACADEMIC_MOTOR_SP
      - TXKEA_SP_ADMIN_MODE_RESULTS__TXKEA_SP_ADMIN_MODE
      - TXKEA_SP_ADMIN_MODE_RESULTS__TXKEA_SP_ADMIN_MODE_DATE
      - KEA_LITERACY_SCREENING_RESULTS__KEA_LITERACY_SCREENING
      - KEA_LITERACY_SCREENING_RESULTS__KEA_LITERACY_SCREENING_DATE
      - KEA_LITERACY_SCREENING_RESULTS__CP_KEA_LITERACY_SCREENING
      - TXKEA_LITERACY-READING_COMPOSITE_RESULTS__TXKEA_LITERACY-READING_COMPOSITE_DATE
      - TXKEA_LITERACY-READING_COMPOSITE_RESULTS__CP_TXKEA_LITERACY-READING_COMPOSITE
      - TXKEA_LANGUAGE_COMPOSITE_RESULTS__TXKEA_LANGUAGE_COMPOSITE_DATE
      - TXKEA_LANGUAGE_COMPOSITE_RESULTS__CP_TXKEA_LANGUAGE_COMPOSITE
      - KEA_DYSLEXIA_SCREENER_RESULTS__KEA_DYSLEXIA_SCREENER
      - KEA_DYSLEXIA_SCREENER_RESULTS__KEA_DYSLEXIA_SCREENER_DATE
      - KEA_DYSLEXIA_SCREENER_RESULTS__CP_KEA_DYSLEXIA_SCREENER
      - TXKEA_Letter_Names_Wave_3
      - TXKEA_Syllabication
      - KEA_LITERACY_SCREENING_SP_RESULTS__KEA_LITERACY_SCREENING_SP_DATE
      - KEA_LITERACY_SCREENING_SP_RESULTS__CP_KEA_LITERACY_SCREENING_SP
      - TXKEA_LITERACY-READING_COMPOSITE_SP_RESULTS__TXKEA_LITERACY-READING_COMPOSITE_SP_DATE
      - TXKEA_LITERACY-READING_COMPOSITE_SP_RESULTS__CP_TXKEA_LITERACY-READING_COMPOSITE_SP
      - TXKEA_LANGUAGE_COMPOSITE_SP_RESULTS__TXKEA_LANGUAGE_COMPOSITE_SP_DATE
      - TXKEA_LANGUAGE_COMPOSITE_SP_RESULTS__CP_TXKEA_LANGUAGE_COMPOSITE_SP
      - KEA_DYSLEXIA_SCREENER_SP_RESULTS__KEA_DYSLEXIA_SCREENER_SP
      - KEA_DYSLEXIA_SCREENER_SP_RESULTS__KEA_DYSLEXIA_SCREENER_SP_DATE
      - KEA_DYSLEXIA_SCREENER_SP_RESULTS__CP_KEA_DYSLEXIA_SCREENER_SP
      - TXKEA_Syllabication_Sp
      - TXKEA_VOCABULARY_3_RESULTS__CP_TXKEA_VOCABULARY_TXKEA_VOCABULARY_3
      - TXKEA_Letter_Names_Wave_2
      - TXKEA_Letter_Names_Wave_2_Date
      - TXKEA_Letter_Names_Wave_3_Date
      - CP_TXKEA_Letter_Names_Wave_3
      - TXKEA_SPELLING_3_RESULTS__CP_TXKEA_SPELLING_TXKEA_SPELLING_3
      - TXKEA_Syllabication_Date
      - CP_TXKEA_Syllabication
      - TXKEA_DECODING_RESULTS__CP_TXKEA_DECODING
      - TXKEA_DECODING_1_RESULTS__TXKEA_DECODING_TXKEA_DECODING_1
      - TXKEA_DECODING_1_RESULTS__TXKEA_DECODING_TXKEA_DECODING_1_DATE
      - TXKEA_DECODING_3_RESULTS__CP_TXKEA_DECODING_TXKEA_DECODING_3
      - TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_RESULTS__CP_TXKEA_LISTENING_COMP_TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE
      - TXKEA_DYSLEXIA_CHECKLIST_RESULTS__TXKEA_DYSLEXIA_CHECKLIST
      - TXKEA_DYSLEXIA_CHECKLIST_RESULTS__TXKEA_DYSLEXIA_CHECKLIST_DATE
      - TXKEA_DYSLEXIA_CHECKLIST_RESULTS__CP_TXKEA_DYSLEXIA_CHECKLIST
      - TXKEA_SCIENCE_3_RESULTS__CP_TXKEA_SCIENCE_TXKEA_SCIENCE_3
      - TXKEA_VOCABULARY_3_SP_RESULTS__CP_TXKEA_VOCABULARY_SP_TXKEA_VOCABULARY_3_SP
      - TXKEA_SPELLING_3_SP_RESULTS__CP_TXKEA_SPELLING_SP_TXKEA_SPELLING_3_SP
      - TXKEA_Syllabication_Sp_Date
      - CP_TXKEA_Syllabication_Sp
      - TXKEA_DECODING_SP_RESULTS__CP_TXKEA_DECODING_SP
      - TXKEA_DECODING_1_SP_RESULTS__TXKEA_DECODING_SP_TXKEA_DECODING_1_SP
      - TXKEA_DECODING_1_SP_RESULTS__TXKEA_DECODING_SP_TXKEA_DECODING_1_SP_DATE
      - TXKEA_DECODING_3_SP_RESULTS__CP_TXKEA_DECODING_SP_TXKEA_DECODING_3_SP
      - TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_SP_RESULTS__CP_TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMPREHENSION_3_RECEPTIVE_SP
      - TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE_SP_RESULTS__CP_TXKEA_LISTENING_COMP_SP_TXKEA_LISTENING_COMPREHENSION_3_EXPRESSIVE_SP
      - TXKEA_DYSLEXIA_CHECKLIST_SP_RESULTS__TXKEA_DYSLEXIA_CHECKLIST_SP
      - TXKEA_DYSLEXIA_CHECKLIST_SP_RESULTS__TXKEA_DYSLEXIA_CHECKLIST_SP_DATE
      - TXKEA_DYSLEXIA_CHECKLIST_SP_RESULTS__CP_TXKEA_DYSLEXIA_CHECKLIST_SP
      - TXKEA_SCIENCE_SP_3_RESULTS__CP_TXKEA_SCIENCE_SP_TXKEA_SCIENCE_SP_3
      - CP_TXKEA_Vocabulary_TXKEA_Vocabulary_2
      - CP_TXKEA_Spelling_TXKEA_Spelling_2
      - CP_TXKEA_Blending_TXKEA_Blending_2
      - CP_TXKEA_Decoding_TXKEA_Decoding_2
      - CP_TXKEA_Science_TXKEA_Science_2
      - CP_TXKEA_Vocabulary_Sp_TXKEA_Vocabulary_2_Sp
      - CP_TXKEA_Spelling_Sp_TXKEA_Spelling_2_Sp
      - CP_TXKEA_Blending_Sp_TXKEA_Blending_2_Expressive_Sp
      - CP_TXKEA_Decoding_Sp_TXKEA_Decoding_2_Sp
      - CP_TXKEA_Science_Sp_TXKEA_Science_Sp_2
      - TXKEA_Letter_Names_1
      - TXKEA_Spelling_1
      - TXKEA_Spelling_1_Sp
      - TXKEA_LETTER_NAMES_1_RESULTS__TXKEA_LETTER_NAMES_TXKEA_LETTER_NAMES_1
      - TXKEA_LETTER_NAMES_1_RESULTS__TXKEA_LETTER_NAMES_TXKEA_LETTER_NAMES_1_DATE
      - TXKEA_LETTER_NAMES_1_RESULTS__CP_TXKEA_LETTER_NAMES_TXKEA_LETTER_NAMES_1
      - TXKEA_LETTER_NAMES_2_RESULTS__TXKEA_LETTER_NAMES_TXKEA_LETTER_NAMES_2
      - TXKEA_LETTER_NAMES_2_RESULTS__TXKEA_LETTER_NAMES_TXKEA_LETTER_NAMES_2_DATE
      - TXKEA_LETTER_NAMES_3_RESULTS__TXKEA_LETTER_NAMES_TXKEA_LETTER_NAMES_3
      - TXKEA_LETTER_NAMES_3_RESULTS__TXKEA_LETTER_NAMES_TXKEA_LETTER_NAMES_3_DATE
      - CP_TXKEA_Decoding_TXKEA_Decoding_1
      - CP_TXKEA_Decoding_Sp_TXKEA_Decoding_1_Sp
      - KEA_DYSLEXIA_SCREENER_SP_RESULTS__TXKEA_DECODING_3_SP
      - TXKEA_LETTER_NAMES_3_RESULTS__CP_TXKEA_LETTER_NAMES_TXKEA_LETTER_NAMES_3
      - TEA_KG_Readiness
      - TEA_KG_Readiness_Date
      - CP_TEA_KG_Readiness
      - TEA_KG_Readiness_Sp
      - TEA_KG_Readiness_Sp_Date
      - CP_TEA_KG_Readiness_Sp
      - CP_TXKEA_Letter_Names_TXKEA_Letter_Names_2
      - KEA_Literacy_Screening_TXKEA_Vocabulary_1
      - KEA_Literacy_Screening_TXKEA_Letter_Names_1
      - KEA_Dyslexia_Screener_TXKEA_Letter_Sounds
      - KEA_Dyslexia_Screener_TXKEA_Blending
      - KEA_Literacy_Screening_Sp_TXKEA_Vocabulary_1_Sp
      - KEA_Literacy_Screening_Sp_TXKEA_Letter_Names_Sp
      - TXKEA_Literacy-Reading_Composite_Sp_TXKEA_Letter_Names_Sp
      - TXKEA_Literacy-Reading_Composite_Sp_TXKEA_Letter_Sounds_Sp
      - KEA_Dyslexia_Screener_Sp_TXKEA_Letter_Sounds_Sp
      - KEA_Dyslexia_Screener_Sp_TXKEA_Blending_Sp


  assessmentReportingMethodDescriptors:
    file: ./seeds/assessmentReportingMethodDescriptors.csv
    header_rows: 1

  performanceLevelDescriptors:
    file: ./seeds/performanceLevelDescriptors.csv
    header_rows: 1

  assessments:
    file: ./seeds/assessments.csv
    header_rows: 1

  objectiveAssessments:
    file: ./seeds/objectiveAssessments.csv
    header_rows: 1

# PREP-STEP 1: CREATE A LIST OF COLUMNS TO STACK VERTICALLY.
# The CLI TX-KEA Data arrives in a wide format with each row representing a single student. To use this data in our templates, we need to pivot the table into a long format.
# This involves standardizing the column titles of subject/objective assessments (e.g., "TXKEA_LETTER_NAMES_RESULTS__TXKEA_LETTER_NAMES") to generic titles (e.g., "subject_name").
# The objective is to stack these conformed columns so that one row represents a student/subject assessed.
# This list will be used in our final "keep columns" step, to indicate the conformed columns we want to retain in the final transformation.
{% set conformed_columns = [
  'wave',
  'student_wave_id', 
  'student_unique_id',
  'local_student_id',
  'student_state_id',
  'school_year',
  'subject_assessment_id',
  'generated_test_id',
  'subject_name',
  'subject_descriptor', 
  'subject_assess_lang',
  'subject_assess_type',
  'subject_score',
  'subject_cut_point',
  'subject_date',  
  'oa_category_1_name',
  'oa_category_2_name',
  'oa_category_3_name',
  'oa_category_4_name',
  'oa_category_5_name',
  'oa_category_6_name',
  'oa_category_1_descriptor',
  'oa_category_2_descriptor',
  'oa_category_3_descriptor',
  'oa_category_4_descriptor',
  'oa_category_5_descriptor',
  'oa_category_6_descriptor',
  'oa_category_1_date',
  'oa_category_2_date',
  'oa_category_3_date',
  'oa_category_4_date',
  'oa_category_5_date',
  'oa_category_6_date',
  'oa_category_1_score',
  'oa_category_2_score',
  'oa_category_3_score',
  'oa_category_4_score',
  'oa_category_5_score',
  'oa_category_6_score',
  'oa_category_1_cut_point',
  'oa_category_2_cut_point',
  'oa_category_3_cut_point',
  'oa_category_4_cut_point',
  'oa_category_5_cut_point',
  'oa_category_6_cut_point',
  'screener_assess_ref_1_name',
  'screener_assess_ref_2_name',
  'screener_assess_ref_3_name',
  'screener_assess_ref_1_descriptor',
  'screener_assess_ref_2_descriptor',
  'screener_assess_ref_3_descriptor',
  'screener_assess_ref_1_score',
  'screener_assess_ref_2_score',
  'screener_assess_ref_3_score',
  'composite_assess_ref_1_name',
  'composite_assess_ref_2_name',
  'composite_assess_ref_3_name',
  'composite_assess_ref_1_descriptor',
  'composite_assess_ref_2_descriptor',
  'composite_assess_ref_3_descriptor',
  'composite_assess_ref_1_score',
  'composite_assess_ref_2_score',
  'composite_assess_ref_3_score'
  ] 
%}


# PREP-STEP 2: CREATE A DICTIONARY OF SUBJECTS AND OBJECTIVE ASSESSMENTS TO CONFORM AND STACK.
# We need this comprehensive dictionary to pass on values to our conformed columns above.
# In CLI TX-KEA data, the subject column names vary between English and Spanish assessments.
# For example, "txkea_letter_names_results__txkea_letter_names" is used for English assessments, while "txkea_letter_names_sp_results__txkea_letter_names_sp" is used for Spanish assessments.
# To handle these distinctions, we create two distinct dictionaries, which eventually merge to undergo the final transformations.

# An output eventually created by this dictionary would look like:
  # student_id | subject_name | subject_descriptor    | ...subject_cut_point   | subject_wave_1_subtest_1_name       | ...subject_wave_1_subtest_1_score
  # 1234       | pa_v2        | Phonological Awareness| ...Support             | txkea_letter_names_results__txkea_letter_names                  | ...10
  # 1234       | math_v1      | Math                  | ...On Track            | kea_dyslexia_screener_results__txkea_blending                      | ...80

{% set subjects = {
    'txkea_dyslexia_checklist_results_txkea_dyslexia_checklist': {
      'prefix': 'txkea_dyslexia_checklist_results',
      'subject_name_spa': 'txkea_dyslexia_checklist_sp_results_txkea_dyslexia_checklist_sp',
      'subject_assess_id': 'dyslexia_checklist',
      'descriptor': 'KG Dyslexia Referral Checklist',
      'subject_assess_type':'checklist',
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'kea_dyslexia_screener_results_kea_dyslexia_screener': {
      'prefix': 'kea_dyslexia_screener_results',
      'subject_name_spa': 'kea_dyslexia_screener_sp_results_kea_dyslexia_screener_sp',
      'subject_assess_id': 'dyslexia_screener',
      'descriptor': 'Dyslexia Screener',
      'subject_assess_type':'screener',
      'subject_assessments': [
        {'subject_assess_ref_1':[{'subject_asses_ref_colname':'kea_dyslexia_screener_results_txkea_letter_sounds', 'subject_asses_ref_colname_spa':'kea_dyslexia_screener_sp_results_txkea_letter_sounds_sp', 'subject_asses_ref_descriptor':'Letter Sounds'}]},
        {'subject_assess_ref_2':[{'subject_asses_ref_colname':'kea_dyslexia_screener_results_txkea_blending', 'subject_asses_ref_colname_spa':'kea_dyslexia_screener_sp_results_txkea_blending_sp', 'subject_asses_ref_descriptor':'Blending'}]},
        {'subject_assess_ref_3':[{'subject_asses_ref_colname_spa':'kea_dyslexia_screener_sp_results_txkea_decoding_3_sp', 'subject_asses_ref_descriptor':'Decoding'}]}
      ],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': False
    },
    'kea_literacy_screening_results_kea_literacy_screening': {
      'prefix': 'kea_literacy_screening_results',
      'subject_name_spa': 'kea_literacy_screening_sp_results_kea_literacy_screening_sp',
      'subject_assess_id': 'literacy_screening',
      'descriptor': 'Literacy Screening',
      'subject_assess_type':'screener',
      'subject_assessments': [
        {'subject_assess_ref_1':[{'subject_asses_ref_colname':'txkea_vocabulary_1', 'subject_asses_ref_colname_spa':'txkea_vocabulary_1_sp', 'subject_asses_ref_descriptor':'Vocabulary Wave 1'}]},
        {'subject_assess_ref_2':[{'subject_asses_ref_colname':'txkea_letter_names_1', 'subject_asses_ref_colname_spa':'txkea_letter_names_sp_results_txkea_letter_names_sp', 'subject_asses_ref_descriptor':'Letter Names Wave 1'}]},
        {'subject_assess_ref_3':[{'subject_asses_ref_colname':'txkea_spelling_1', 'subject_asses_ref_colname_spa':'txkea_spelling_1_sp', 'subject_asses_ref_descriptor':'Spelling Wave 1'}]}
      ],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': False
    },
    'txkea_literacy_reading_composite_results_txkea_literacy_reading_composite': {
      'prefix': 'txkea_literacy_reading_composite_results',
      'subject_name_spa': 'txkea_literacy_reading_composite_sp_results_txkea_literacy_reading_composite_sp',
      'subject_assess_id': 'literacy_reading_composite',
      'descriptor': 'Literacy Reading Composite',
      'subject_assess_type':'composite',
      'subject_assessments': [
        {'subject_assess_ref_1':[{'subject_asses_ref_colname':'txkea_letter_names_1', 'subject_asses_ref_colname_spa': 'txkea_letter_names_sp_results_txkea_letter_names_sp', 'subject_asses_ref_descriptor':'Letter Names Wave 1'}]},
        {'subject_assess_ref_2':[{'subject_asses_ref_colname':'txkea_letter_sounds_1', 'subject_asses_ref_colname_spa': 'kea_dyslexia_screener_sp_results_txkea_letter_sounds_sp', 'subject_asses_ref_descriptor':'Letter Sounds 1'}]},
        {'subject_assess_ref_3':[{'subject_asses_ref_colname':'txkea_blending_1', 'subject_asses_ref_colname_spa': 'txkea_blending_1_sp', 'subject_asses_ref_descriptor':'Blending 1'}]}
      ],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': False
    },
    'txkea_language_composite_results_txkea_language_composite': {
      'prefix': 'txkea_language_composite_results',
      'subject_name_spa': 'txkea_language_composite_sp_results_txkea_language_composite_sp',
      'subject_assess_id': 'language_composite',
      'descriptor': 'Language Composite',
      'subject_assess_type':'composite',
      'subject_assessments': [
        {'subject_assess_ref_1':[{'subject_asses_ref_colname':'txkea_vocabulary_1', 'subject_asses_ref_colname_spa': 'txkea_vocabulary_1_sp', 'subject_asses_ref_descriptor':'Vocabulary Wave 1'}]},
        {'subject_assess_ref_2':[{'subject_asses_ref_colname':'txkea_listening_comp_1', 'subject_asses_ref_colname_spa': 'txkea_listening_comp_1_sp', 'subject_asses_ref_descriptor':'Listening Comprehension 1'}]}
      ],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': False
    },
    'txkea_letter_names_results_txkea_letter_names': {
      'prefix': 'txkea_letter_names_results',
      'subject_name_spa': 'txkea_letter_names_sp_results_txkea_letter_names_sp',
      'subject_assess_id': 'letter_names',
      'descriptor': 'Letter Names',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_spelling_results_txkea_spelling': {
      'prefix': 'txkea_spelling_results',
      'subject_name_spa': 'txkea_spelling_sp_results_txkea_spelling_sp',
      'subject_assess_id': 'spelling',
      'descriptor': 'Spelling',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_listening_comp_results_txkea_listening_comp': { 
      'prefix': 'txkea_listening_comp_results',
      'subject_name_spa': 'txkea_listening_comp_sp_results_txkea_listening_comp_sp',
      'subject_assess_id': 'listening_comp',
      'descriptor': 'Listening Comp',
      'subject_assess_type':'subject',
      'objective_assessments':[
        {'oa_category_1':{'colname':'txkea_listening_comp_2_receptive_results_txkea_listening_comp_txkea_listening_comp_2_receptive', 'colname_spa':'txkea_listening_comp_2_receptive_sp_results_txkea_listening_comp_sp_txkea_listening_comp_2_receptive_sp', 'descriptor':'Listening Comp 2 Receptive', 'has_cp_col': False}}, 
        {'oa_category_2':{'colname':'txkea_listening_comp_2_expressive_results_txkea_listening_comp_txkea_listening_comp_2_expressive', 'colname_spa':'txkea_listening_comp_2_expressive_sp_results_txkea_listening_comp_sp_txkea_listening_comp_2_expressive_sp', 'descriptor':'Listening Comp 2 Expressive', 'has_cp_col': False}}, 
        {'oa_category_3':{'colname':'txkea_listening_comprehension_3_receptive_results_txkea_listening_comp_txkea_listening_comprehension_3_receptive',
                          'colname_spa':'txkea_listening_comprehension_3_receptive_sp_results_txkea_listening_comp_sp_txkea_listening_comprehension_3_receptive_sp', 'descriptor':'Listening Comprehension 3 Receptive',
                          'has_cp_col': True, 
                          'prefix': 'txkea_listening_comprehension_3_receptive_results'}}, 
        {'oa_category_4':{'colname':'txkea_listening_comprehension_3_expressive_results_txkea_listening_comp_txkea_listening_comprehension_3_expressive', 'colname_spa':'txkea_listening_comprehension_3_expressive_sp_results_txkea_listening_comp_sp_txkea_listening_comprehension_3_expressive_sp', 'descriptor':'Listening Comprehension 3 Expressive - Dropped', 'has_cp_col': False}}
      ],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_vocabulary_results_txkea_vocabulary': { 
      'prefix': 'txkea_vocabulary_results',
      'subject_name_spa': 'txkea_vocabulary_sp_results_txkea_vocabulary_sp',
      'subject_assess_id': 'vocabulary',
      'descriptor': 'Vocabulary',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_decoding_results_txkea_decoding': { 
      'prefix': 'txkea_decoding_results',
      'subject_name_spa': 'txkea_decoding_sp_results_txkea_decoding_sp',
      'subject_assess_id': 'decoding',
      'descriptor': 'Decoding',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_letter_sounds_results_txkea_letter_sounds': {  
      'prefix': 'txkea_letter_sounds_results',
      'subject_name_spa': 'txkea_letter_sounds_sp_results_txkea_letter_sounds_sp',
      'subject_assess_id': 'letter_sounds',
      'descriptor': 'Letter Sounds',
      'subject_assess_type':'subject',
      'objective_assessments':[
        {'oa_category_1':{'colname':'txkea_letter_sounds_2_receptive_results_txkea_letter_sounds_txkea_letter_sounds_2_receptive', 'descriptor':'Letter Sounds 2 Receptive', 'has_cp_col': False}}, 
        {'oa_category_2':{'colname':'txkea_letter_sounds_2_expressive_results_txkea_letter_sounds_txkea_letter_sounds_2_expressive', 'descriptor':'Letter Sounds 2 Expressive', 'has_cp_col': False}}, 
        {'oa_category_3':{'colname':'txkea_letter_sounds_3_receptive_results_txkea_letter_sounds_txkea_letter_sounds_3_receptive', 'descriptor':'Letter Sounds 3 Receptive', 'has_cp_col': False}}, 
        {'oa_category_4':{'colname':'txkea_letter_sounds_3_expressive_results_txkea_letter_sounds_txkea_letter_sounds_3_expressive', 'descriptor':'Letter Sounds 3 Expressive', 'has_cp_col': False}}
      ],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_blending_results_txkea_blending': {  
      'prefix': 'txkea_blending_results',
      'subject_name_spa': 'txkea_blending_sp_results_txkea_blending_sp',
      'subject_assess_id': 'blending',
      'descriptor': 'Blending',
      'subject_assess_type':'subject',
      'objective_assessments':[
        {'oa_category_1':{'colname_spa':'txkea_blending_2_expressive_sp_results_txkea_blending_sp_txkea_blending_2_expressive_sp', 'descriptor':'Blending 2 Expressive', 'has_cp_col': False}}, 
        {'oa_category_2':{'colname_spa':'txkea_blending_2_receptive_sp_results_txkea_blending_sp_txkea_blending_2_receptive_sp', 'descriptor':'Blending 2 Receptive', 'has_cp_col': False}}, 
        {'oa_category_3':{'colname':'txkea_blending_3_receptive_results_txkea_blending_txkea_blending_3_receptive', 'colname_spa':'txkea_blending_3_receptive_sp_results_txkea_blending_sp_txkea_blending_3_receptive_sp', 'descriptor':'Blending 3 Receptive', 'has_cp_col': False}}, 
        {'oa_category_4':{'colname':'txkea_blending_3_expressive_results_txkea_blending_txkea_blending_3_expressive', 'colname_spa':'txkea_blending_3_expressive_sp_results_txkea_blending_sp_txkea_blending_3_expressive_sp', 'descriptor':'Blending 3 Expressive', 'has_cp_col': False}}
      ],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_math_results_txkea_math': {  
      'prefix': 'txkea_math_results',
      'subject_name_spa': 'txkea_math_sp_results_txkea_math_sp',
      'subject_assess_id': 'math',
      'descriptor': 'Math',
      'subject_assess_type':'subject',
      'objective_assessments':[
        {'oa_category_1':{'colname':'txkea_math_part_1_results_txkea_math_txkea_math_part_1', 'colname_spa':'txkea_math_part_1_sp_results_txkea_math_sp_txkea_math_part_1_sp', 'descriptor':'Math Part 1', 'has_cp_col': False}}, 
        {'oa_category_2':{'colname':'txkea_math_part_2_results_txkea_math_txkea_math_part_2', 'colname_spa':'txkea_math_part_2_sp_results_txkea_math_sp_txkea_math_part_2_sp', 'descriptor':'Math Part 2', 'has_cp_col': False}}, 
        {'oa_category_3':{'colname':'txkea_math_part_1_w2_results_txkea_math_txkea_math_part_1_w2', 'colname_spa':'txkea_math_part_1_w2_sp_results_txkea_math_sp_txkea_math_part_1_w2_sp', 'descriptor':'Math Part 1 W2', 'has_cp_col': False}}, 
        {'oa_category_4':{'colname':'txkea_math_part_2_w2_results_txkea_math_txkea_math_part_2_w2', 'colname_spa':'txkea_math_part_2_w2_sp_results_txkea_math_sp_txkea_math_part_2_w2_sp', 'descriptor':'Math Part 2 W2', 'has_cp_col': False}},
        {'oa_category_5':{'colname':'txkea_math_part_1_w3_results_txkea_math_txkea_math_part_1_w3', 'colname_spa':'txkea_math_part_1_w3_sp_results_txkea_math_sp_txkea_math_part_1_w3_sp', 'descriptor':'Math Part 1 W3', 'has_cp_col': False}},
        {'oa_category_6':{'colname':'txkea_math_part_2_w3_results_txkea_math_txkea_math_part_2_w3', 'colname_spa':'txkea_math_part_2_w3_sp_results_txkea_math_sp_txkea_math_part_2_w3_sp', 'descriptor':'Math Part 2 W3', 'has_cp_col': False}}
      ],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_science_results_txkea_science': {  
      'prefix': 'txkea_science_results',
      'subject_name_spa': 'txkea_science_sp_results_txkea_science_sp',
      'subject_assess_id': 'science',
      'descriptor': 'Science',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_social_emotional_results_txkea_social_emotional': {  
      'prefix': 'txkea_social_emotional_results',
      'subject_name_spa': 'txkea_social_emotional_sp_results_txkea_social_emotional_sp',
      'subject_assess_id': 'social_emotional',
      'descriptor': 'Social Emotional Competence',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_emotional_management_results_txkea_emotional_management': {  
      'prefix': 'txkea_emotional_management_results',
      'subject_name_spa': 'txkea_emotional_management_sp_results_txkea_emotional_management_sp',
      'subject_assess_id': 'emotional_management',
      'descriptor': 'Emotion Management',
      'subject_assess_type':'subject',
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_working_memory_results_txkea_working_memory': {  
      'prefix': 'txkea_working_memory_results',
      'subject_name_spa': 'txkea_working_memory_sp_results_txkea_working_memory_sp',
      'subject_assess_id': 'working_memory',
      'descriptor': 'Working Memory',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_inhibition_results_txkea_inhibition': {  
      'prefix': 'txkea_inhibition_results',
      'subject_name_spa': 'txkea_inhibition_sp_results_txkea_inhibition_sp',
      'subject_assess_id': 'inhibition',
      'descriptor': 'Inhibition',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_attention_results_txkea_attention': {  
      'prefix': 'txkea_attention_results',
      'subject_name_spa': 'txkea_attention_sp_results_txkea_attention_sp',
      'subject_assess_id': 'attention',
      'descriptor': 'Attention',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_academic_motor_results_txkea_academic_motor': {  
      'prefix': 'txkea_academic_motor_results',
      'subject_name_spa': 'txkea_academic_motor_sp_results_txkea_academic_motor_sp',
      'subject_assess_id': 'academic_motor',
      'descriptor': 'Academic Motor Skills',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': True
    },
    'txkea_en_admin_mode_results_txkea_en_admin_mode': {  
      'prefix': 'txkea_en_admin_mode_results',
      'subject_name_spa': 'txkea_sp_admin_mode_results_txkea_sp_admin_mode',
      'subject_assess_id': 'admin_mode',
      'descriptor': 'Administration Mode',
      'subject_assess_type':'subject',
      'objective_assessments':[],
      'subject_assess_lang': ['English','Spanish'],
      'has_cp_col': False
    }
  }
%}


# TRANSFORMATION-STEP 1: CONVERT COLUMNS TO SNAKE CASE
# Certain columns in the data arrive with spaces or use "-" symbols instead of "_" as separators.
# For uniformity, we convert all columns to snake case before we begin working on the data. 

transformations:
  input:
    source: $sources.input
    operations: []
  cli_tx_kea_student_assessment:
    source: $transformations.input
    operations:
      - operation: duplicate_columns
        columns: 
          ${STUDENT_ID_NAME}: studentUniqueId 
      - operation: snake_case_columns
      - operation: modify_columns
        columns:
          school_year: "{%raw%}20{{ value[-2:] }}{%endraw%}"
          wave: "{%raw%}{{ wave |replace(' ', '_') }}{%endraw%}"
      - operation: add_columns
        columns:
          student_wave_id: '{%raw%}{{ wave }}_{{ school_year }}_{{ school_engage_id }}_{{ student_engage_id }}{%endraw%}'


# TRANSFORMATION-STEP 2: ITERATE THROUGH SUBJECT DICTIONARY TO STANDARDIZE COLUMNS
# This loop creates the main subject columns in our conformed columns list.

{% for subject_name, subject_values in subjects.items() %}
  {% for assess_lang in subject_values.subject_assess_lang %}

    {% if assess_lang == 'English' %}
      {% set subject_colname = subject_name %}
      {% set subject_assess_lang = 'eng' %}
      {% set prefix = subject_values.prefix %}
    {% elif assess_lang == 'Spanish' %}
      {% set subject_colname = subject_values.subject_name_spa %}
      {% set subject_assess_lang = 'spa' %}
      {% set prefix = subject_values.prefix | replace('results', 'sp_results') %}
    {% endif %}

    {% set suffix = subject_colname | replace(prefix+'_', '') %}

  cli_tx_kea_student_{{ subject_colname }}:
    source: $transformations.cli_tx_kea_student_assessment
    operations:
      - operation: rename_columns
        columns:
          {{ subject_colname }}: subject_score
          {{ subject_colname }}_date: subject_date

      - operation: add_columns
        columns:
          subject_assessment_id: tx_kea_{{ subject_values.subject_assess_id }}
          subject_name: {{ subject_name }}
          subject_descriptor: {{ subject_values.descriptor }}
          subject_assess_lang: {{ subject_assess_lang }}
          subject_assess_type: {{ subject_values.subject_assess_type }}
          generated_test_id: '{%raw%}{{ student_wave_id }}_{{ subject_assessment_id }}_{{ subject_assess_lang }}{%endraw%}'

      # Addressing subjects without a Cut Point column: -------------------------------------------------------------------
      # In cases where a cut point column is missing for a particular subject in the dataset,
      # we generate a null column named "subject_cut_point" to prevent any disruption of our "keep columns" transformation.

      {% if subject_values.has_cp_col %}
      - operation: rename_columns
        columns:
          {{ prefix }}_cp_{{ suffix }}: subject_cut_point
      {% else %}
      - operation: add_columns
        columns:
          subject_cut_point: ''
      {% endif %}


    # Handling subjects with multiple Objective Assessments for student assessments:  ------------------------------------------------------------------------------
    # Certain subjects within CLI TX-KEA contain Objective Assessments ("Expressive" and "Receptive")
    # To capture this information, we introduce a "oa_category_x" column, indicating the objective on which a student was assessed.

        {% set cat_numbers=[] -%}

        {% for objective_assessment in subject_values.objective_assessments %}
          {% for oa_category, oa_values in objective_assessment.items() %}
            # Dealing with Spanish and English colname differences.
              {% if assess_lang == 'English' %}
                {% set oa_colname = oa_values.colname %}
              {% elif assess_lang == 'Spanish' %}
                {% set oa_colname = oa_values.colname_spa %}
              {% endif %}

              {% if oa_colname is not none and oa_colname | length %}
      # Creating basic columns for OAs.      
      - operation: rename_columns
        columns:
          {{ oa_colname }}: {{ oa_category }}_score
          {{ oa_colname }}_date: {{ oa_category }}_date    

      - operation: add_columns
        columns:
          {{ oa_category }}_name: {{oa_colname }}
          {{ oa_category }}_descriptor: {{ oa_values.descriptor }} 

      # In cases where a cut point column is missing for a particular OA in the dataset,
      # we generate a null column named "oa_category_x_cut_point" to prevent any disruption of our "keep columns" transformation.
      {% if oa_values.has_cp_col %}
      {% set prefix = oa_values.prefix %}
      {% if assess_lang == 'Spanish' %}
        {% set prefix = prefix | replace('results', 'sp_results') %}
      {% endif %}
      {% set suffix = oa_colname | replace(prefix+'_', '') %}
      - operation: rename_columns
        columns:
          {{ prefix }}_cp_{{ suffix }}: {{ oa_category }}_cut_point
            {% else %}
      - operation: add_columns
        columns:
          {{ oa_category }}_cut_point: ''              
      {% endif %}

      # Append an empty record to our list above if a total of 7 OAs are not found on the subject record (need this for the keep columns operation).
      # This will let us construct the rest of the "oa_category_x" columns, so if "pa_v2" only has 4 objective assessments we append "1,2,3,4" to the empty cat_numbers list above
      # Then the code below will build the rest of the range for the numbers missing (e.g. "5,6,7")
          {% set cat_number = cat_numbers.append(oa_category.split('_')[-1]) %}   
              {% endif %}
            {% endfor %}
          {% endfor %}

      # Create additional null columns if not found in the list for this subject (need this for the keep columns operation).
        {% for n in range(1, 7) %}
          {% if n|string not in cat_numbers %}
      - operation: add_columns
        columns:
          oa_category_{{ n }}_name: ''  
          oa_category_{{ n }}_descriptor: '' 
          oa_category_{{ n }}_date: '' 
          oa_category_{{ n }}_score: '' 
          oa_category_{{ n }}_cut_point: '' 
          {%- endif -%}      
        {%- endfor -%}


    # Handling screening and composite subject assessments:  ------------------------------------------------------------------------------
    # CLI TX-KEA contains screening and composite assessments - these assessments use combined values from other subjects to grade a student on a specific focus area:
      # kea_dyslexia_screener_results_kea_dyslexia_screener: Letter Sounds, Blending, Decoding.
      # kea_literacy_screening_results_kea_literacy_screening: Vocabulary 1, Letter Names, Spelling 1.
      # txkea_literacy_reading_composite: Letter Names, Letter Sounds, Blending 1.
      # txkea_language_composite_results_txkea_language_composite: Vocabulary 1, Listenining Comp 1.
    # To capture this information, we introduce a "screener_assess_ref_x" and "screener_assess_ref_x" columns, indicating the subject, type, and subtest reference that builds the respective assessment.
    
    # Make sure the assessment type is either 'composite' or 'screener'
    {% if subject_values.subject_assess_type in ['composite', 'screener'] %}
      # If we are building this loop for "composite" types, then set remainder_subject_assess_type= 'screener' and viceversa.
      {% set remainder_subject_assess_type = (['composite', 'screener'] | reject("==", subject_values.subject_assess_type) | list ) %}
      {% set subject_assess_ref_numbers = [] %}
      {% for subject_assessments in subject_values.subject_assessments %}
        {% for subject_assess_ref, subject_assess_ref_values in subject_assessments.items() %}
          {% for subject_assess_item in subject_assess_ref_values%}
          # Dealing with Spanish and English colname differences.
            {% if assess_lang == 'English' %}
              {% set subject_assess_ref_values_colname = subject_assess_item.subject_asses_ref_colname %}
            {% elif assess_lang == 'Spanish' %}
              {% set subject_assess_ref_values_colname = subject_assess_item.subject_asses_ref_colname_spa %}
              {% set subject_assess_lang = 'Spanish' %}
            {% endif %}

            {% if subject_assess_ref_values_colname is not none and subject_assess_ref_values_colname | length %}
      # Creating basic columns for screener/composite subjects.
      - operation: rename_columns
        columns:
          {% set sa_n = subject_assess_ref.split('_')[-1] %}
          {{ subject_assess_ref_values_colname }}: {{subject_values.subject_assess_type}}_assess_ref_{{ sa_n }}_score
      - operation: add_columns
        columns:
          {{subject_values.subject_assess_type}}_assess_ref_{{ sa_n }}_name: {{ subject_assess_ref_values_colname }}
          {{subject_values.subject_assess_type}}_assess_ref_{{ sa_n }}_descriptor: {{ subject_assess_item.subject_asses_ref_descriptor }}

      {% set subject_assess_ref_append = subject_assess_ref_numbers.append(sa_n) %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% endfor %}

      # Create additional null columns if not found in the dictionary for this subject (need this for the keep columns operation).
      {% for n in range(1, 4) %}
        {% if n|string not in subject_assess_ref_numbers %}
      - operation: add_columns
        columns:
          {{subject_values.subject_assess_type}}_assess_ref_{{ n }}_name: ''  
          {{subject_values.subject_assess_type}}_assess_ref_{{ n }}_descriptor: '' 
          {{subject_values.subject_assess_type}}_assess_ref_{{ n }}_score: ''  
        {%- endif -%}      
      {%- endfor %}
      
      # Create additional null columns for the remainder subject assessment type.
      {% for n in range(1, 4) %}
        {% for remainder_subject in remainder_subject_assess_type %}
      - operation: add_columns
        columns:
          {{ remainder_subject }}_assess_ref_{{ n }}_name: ''  
          {{ remainder_subject }}_assess_ref_{{ n }}_descriptor: '' 
          {{ remainder_subject }}_assess_ref_{{ n }}_score: ''          
        {% endfor %}
      {% endfor %}
      
    {% else %}
      # Create additional null columns for any other subject assessment type that is not 'composite' or 'screener'.
        {% for n in range(1, 4) %}
      - operation: add_columns
        columns:
          screener_assess_ref_{{ n }}_name: ''  
          screener_assess_ref_{{ n }}_descriptor: '' 
          screener_assess_ref_{{ n }}_score: ''  
          composite_assess_ref_{{ n }}_name: ''  
          composite_assess_ref_{{ n }}_descriptor: '' 
          composite_assess_ref_{{ n }}_score: ''           
        {%- endfor %}      
    {% endif %}

      # Filter out any data with empty scores and dates (so any rows that don't have a valid subject score taken).
      - operation: filter_rows
        query: subject_score != '' and subject_date != '' and student_state_id != ''
        behavior: include 

      {% if subject_name not in ('kea_dyslexia_screener_results_kea_dyslexia_screener', 'kea_literacy_screening_results_kea_literacy_screening', 'txkea_literacy_reading_composite_results_txkea_literacy_reading_composite', 'txkea_language_composite_results_txkea_language_composite') %}
      - operation: date_format
        columns:
          - subject_date
          - oa_category_1_date
          - oa_category_2_date
          - oa_category_3_date
          - oa_category_4_date
          - oa_category_5_date
          - oa_category_6_date
        from_format: "%m/%d/%Y %H:%M"
        to_format: "%Y-%m-%d" 
        ignore_errors: True
      {% else %}
      - operation: date_format
        column: subject_date
        from_format: "%m/%d/%Y"
        to_format: "%Y-%m-%d" 
      {% endif %}

      # Finally, we keep the conformed columns we need for the templates.
      - operation: keep_columns
        columns: {{conformed_columns}}

  {% endfor %}
{% endfor %}


# TRANSFORMATION-STEP 3: STACK ALL SUBJECT DATA TOGETHER
# Stack all the data we created together.
  stacked_subject_scores:
    source: $transformations.cli_tx_kea_student_txkea_dyslexia_checklist_results_txkea_dyslexia_checklist
    operations:
      - operation: union
        sources:
# To avoid duplicates, we remove txkea_dyslexia_checklist_results_txkea_dyslexia_checklist from this join (so we don't join txkea_dyslexia_checklist_results_txkea_dyslexia_checklist twice - once as a source above and as a joined table below)
{% for subject_name, subject_values in subjects.items() %}
  {% for assess_lang in subject_values.subject_assess_lang %}

    {% if assess_lang == 'English' %}
      {% set subject_colname = subject_name %}
    {% elif assess_lang == 'Spanish' %}
      {% set subject_colname = subject_values.subject_name_spa %}
    {% endif %}

    {% if subject_colname != 'txkea_dyslexia_checklist_results_txkea_dyslexia_checklist' %}
          - $transformations.cli_tx_kea_student_{{ subject_colname }}
    {% endif %}  
  {% endfor %} 
{% endfor %} 
        

destinations:
  studentAssessments:
    source: $transformations.stacked_subject_scores
    template: ./templates/studentAssessments.jsont
    extension: jsonl

  objectiveAssessments:
    source: $sources.objectiveAssessments
    template: ./templates/objectiveAssessments.jsont
    extension: jsonl

  assessmentReportingMethodDescriptors:
    source: $sources.assessmentReportingMethodDescriptors
    template: ./templates/assessmentReportingMethodDescriptors.jsont
    extension: jsonl

  assessments:
    source: $sources.assessments
    template: ./templates/assessments.jsont
    extension: jsonl

  performanceLevelDescriptors:
    source: $sources.performanceLevelDescriptors
    template: ./templates/performanceLevelDescriptors.jsont
    extension: jsonl
