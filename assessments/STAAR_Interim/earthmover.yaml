# See accompanying README.md for details about this file.

config:
  log_level: DEBUG
  output_dir: ${OUTPUT_DIR} # this will be a parameter that is passed through from the command line, leave this as-is
  memory_limit: 1GB
  state_file: ./runs.csv
  show_graph: False
  parameter_defaults:
    # the following should be included in every template
    STUDENT_ID_JOIN_COLUMN: PEIMS-ID
    STUDENT_ID_NAME: PEIMS-ID
    STUDENT_ID_XWALK: ''




sources:
  # TODO: add or remove these bootstrap sources as necessary
  assessmentReportingMethodDescriptors:
    file: ${BUNDLE_DIR}/seeds/assessmentReportingMethodDescriptors.csv # follow this pattern for sourcing
    header_rows: 1
  performanceLevelDescriptors:
    file: ${BUNDLE_DIR}/seeds/performanceLevelDescriptors.csv
    header_rows: 1
  assessments:
    file: ${BUNDLE_DIR}/seeds/assessments.csv
    header_rows: 1

  # TODO: add additional student assessment files as necessary
  assessment_type_input: # TODO: replace 'assessment_type' with the actual assessment type
    # THIS FILE DOES NOT EXIST; IT MUST BE SUPPLIED BY THE USER!
    file: ${INPUT_FILE} # leave this as-is, unless multiple input files are required
    header_rows: 1
    # See the accompanying README.md for a list of required columns for this file

  # this source should be included in every template
  student_id_xwalk:
    # This file only needs to be supplied if the source assessment file does not
    # contain the studentUniqueId used by Ed-Fi
    file: ${STUDENT_ID_XWALK}
    header_rows: 1
    columns:
      - from
      - to
    optional: True


transformations:
  # these first two transformations should be included in every template
  assessment_type_student_assessment: # TODO: replace 'assessment_type' with the actual assessment type
    operations:
      - operation: join
        sources:
          - $sources.assessment_type_input # TODO: change this to match the name of your input file
          - $sources.student_id_xwalk
        left_key: ${STUDENT_ID_JOIN_COLUMN}
        right_key: from
        join_type: left
      - operation: duplicate_columns
        source: $transformations.assessment_type_student_assessment # TODO: change this to match the name of the above transformation
        columns:
          ${STUDENT_ID_NAME}: studentUniqueId

  # TODO: remove this if not necessary and create additional transformations for other bootstrap if necessary

  ## sometimes it is necessary/helpful to create the objective assessment/other bootstrap data from the
  ## student assessment data itself, so the source for this could be a pre-created bootstrap file,
  ## the original student assessment file, or an above transformation
  objective_assessments:
    operations:
      - operation: distinct_rows # TODO: this is just an example, add operations as necessary
        source: $transformations. # TODO: this depends, read comment above

# TODO: add/remove as needed
destinations:
  objectiveAssessments:
    source: $transformations.objective_assessments
    template: ${BUNDLE_DIR}/templates/objectiveAssessments.jsont
    extension: jsonl
    linearize: True
  studentAssessments:
    source: $transformations.assessment_type_student_assessment
    template: ${BUNDLE_DIR}/templates/studentAssessment.jsont
    extension: jsonl
    linearize: True