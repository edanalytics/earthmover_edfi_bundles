version: 2

config:
  log_level: DEBUG
  output_dir: ${OUTPUT_DIR}
  state_file: ${STATE_FILE}
  show_graph: False
  show_stacktrace: True
  parameter_defaults:
    source_encoding: latin-1
    INPUT_FILE: ''
    API_YEAR: ''
    BUNDLE_DIR: ''
    INPUT_FILETYPE: csv
  optional_fields:
    #ELA Specific
    - Phonological Awareness Scale Score
    - Phonological Awareness Placement
    - Phonological Awareness Relative Placement
    - Phonics Scale Score
    - Phonics Placement
    - Phonics Relative Placement
    - High-Frequency Words Scale Score
    - High-Frequency Words Placement
    - High-Frequency Words Relative Placement
    - Vocabulary Scale Score
    - Vocabulary Placement
    - Vocabulary Relative Placement
    - 'Comprehension: Overall Scale Score'
    - 'Comprehension: Overall Placement'
    - 'Comprehension: Overall Relative Placement'
    - 'comprehension: Literature Scale Score'
    - 'Comprehension: Literature Placement'
    - 'Comprehension: Literature Relative Placement'
    - 'Comprehension: Informational Text Scale Score'
    - 'Comprehension: Informational Text Placement'
    - 'Comprehension: Informational Text Relative Placement'
    - Reading Difficulty Indicator (Y/N)

    #Lexiles
    - Lexile Measure
    - Lexile Range

    #Math Specific
    - Number and Operations Scale Score
    - Number and Operations Placement
    - Number and Operations Relative Placement
    - Algebra and Algebraic Thinking Scale Score
    - Algebra and Algebraic Thinking Placement
    - Algebra and Algebraic Thinking Relative Placement
    - Measurement and Data Scale Score
    - Measurement and Data Placement
    - Measurement and Data Relative Placement
    - Geometry Scale Score
    - Geometry Placement
    - Geometry Relative Placement

    #Quantiles
    - Quantile Measure
    - Quantile Range

sources:

  assessmentReportingMethodDescriptors:
    file: ${BUNDLE_DIR}/seeds/assessmentReportingMethodDescriptors.csv
    header_rows: 1

  performanceLevelDescriptors:
    file: ${BUNDLE_DIR}/seeds/performanceLevelDescriptors.csv
    header_rows: 1

  objectiveAssessments:
    file: ${BUNDLE_DIR}/seeds/objectiveAssessments.csv
    header_rows: 1

  assessments:
    file: ${BUNDLE_DIR}/seeds/assessments.csv
    header_rows: 1

  iready_input:
    file: ${INPUT_FILE}
    type: ${INPUT_FILETYPE}
#    encoding: ${source_encoding}


transformations:

  iready_student_assessment:
    source: $sources.iready_input
    operations:
      - operation: keep_columns
        columns:
          # Generic fields
          - Student ID
          - LEA_ID
          - Student Grade
          - Start Date
          - Overall Scale Score
          - Overall Placement
          - Overall Relative Placement
          - Percentile
          - Grouping
          - Percent Progress to Annual Typical Growth (%)
          - Percent Progress to Annual Stretch Growth (%)
          - Mid On Grade Level Scale Score

      - operation: rename_columns
        columns:
          Student ID: student_unique_id
          Start Date: administration_date
          Academic Year: school_year
          Overall Scale Score: overall_scale_score
          Overall Placement: overall_placement
          Overall Relative Placement: overall_relative_placement
          Lexile Measure: lexile_measure
          Lexile Range: lexile_range
          Quantile Measure: quantile_measure
          Quantile Range: quantile_range
      - operation: filter_rows
        query: student_unique_id.notnull() & (student_unique_id != "") & (student_unique_id != "0")
        behavior: include
      - operation: modify_columns
          school_year: "{%raw%}{{value[:4]}}{%endraw%}"

destinations:

  assessments:
    source: $sources.assessments
    template: ${BUNDLE_DIR}/templates/assessments.jsont
    extension: jsonl
    linearize: True

  objectiveAssessments:
    source: $transformations.objective_assessments
    template: ${BUNDLE_DIR}/templates/objectiveAssessments.jsont
    extension: jsonl
    linearize: True

  assessmentReportingMethodDescriptors:
    source: $sources.assessmentReportingMethodDescriptors
    template: ${BUNDLE_DIR}/templates/assessmentReportingMethodDescriptors.jsont
    extension: jsonl
    linearize: True

  studentAssessments:
    source: 
    template: ${BUNDLE_DIR}/templates/studentAssessments.jsont
    extension: jsonl
    linearize: True