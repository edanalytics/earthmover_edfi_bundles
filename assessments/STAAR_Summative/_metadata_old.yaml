# example_bundle_metadata.yaml
# TODO:  question: are seed files part of input_files? I think not because they're just part of the bundle
# FIXME: check that all required columns do indeed come from the source files and not from seeds
display_name: "STAAR Summative"
valid_edfi: ">=3.0"
# valid_years: 
# TODO: I figure if there are notrestrictions on valid years,
#     we should just omit the key. But we could also use a special value for 'any'
input_files:
  - display_name: "Assessment data"
    env_var: "INPUT_FILE"
    is_required: true
    file_type: "csv" 
    required_cols: ["tx_unique_student_id", "county_district_campus_number", "administration_date"]
    header_rows: 1
input_params:
  - display_name: "School Year"
    env_var: "API_YEAR"
    is_required: true
  - display_name: "Reporting Data Format"
    env_var: "FORMAT"
    is_required: true
    allowed_values: ["Std", "EOC", "Alt", "EOC-Alt"]

assessments:
  - display_name: "Grades 3-8"
    input_files:
      - env_var: "INPUT_FILE" # TODO: Keying by ENV_VAR seems like the best way to link back to lower-priority / higher-level configs without repeating ourselves
        required_cols: ["mathematics_raw_score", "social_studies_raw_score", "science_raw_score", "mathematics_test_version", "social_studies_test_version", "science_test_version", "mathematics_scale_score", "social_studies_scale_score", "science_scale_score"]
    assessments:
      - display_name: ""
        input_files:
          - env_var: "INPUT_FILE"
            required_cols: ["grade_level_tested", "meets_grade_level_in_mathematics", "meets_grade_level_in_social_studies", "meets_grade_level_in_science", "approaches_grade_level_in_mathematics", "approaches_grade_level_in_social_studies", "approaches_grade_level_in_science", "masters_grade_level_in_mathematics", "masters_grade_level_in_social_studies", "masters_grade_level_in_science", "score_code_mathematics", "score_code_social_studies", "score_code_science"]
        input_params:
          - env_var: "FORMAT"
            hardwire_value: "Std"
        assessments:
          - display_name: "(2021 and earlier)"
            input_files:
              - env_var: "INPUT_FILE"
                required_cols: ["document_number", "meets_grade_level_in_reading", "approaches_grade_level_in_reading", "masters_grade_level_in_reading", "score_code_reading", "reading_reporting_category_scores", "mathematics_reporting_category_scores", "social_studies_reporting_category_scores", "science_reporting_category_scores", "writing_reporting_category_scores", "writing_raw_score", "writing_scale_score", "writing_test_version", "meets_grade_level_in_writing", "approaches_grade_level_in_writing", "masters_grade_level_in_writing", "score_code_writing"]
                # note that we don't hardwire API_YEAR here since there is a range
          - display_name: "(2022)"
            input_files:
              - env_var: "INPUT_FILE"
                required_cols: ["mathematics_reporting_category_1_scores", "mathematics_reporting_category_2_scores", "mathematics_reporting_category_3_scores", "mathematics_reporting_category_4_scores", "social_studies_reporting_category_1_scores", "social_studies_reporting_category_2_scores", "social_studies_reporting_category_3_scores", "social_studies_reporting_category_4_scores", "science_reporting_category_1_scores", "science_reporting_category_2_scores", "science_reporting_category_3_scores", "science_reporting_category_4_scores", "reading_reporting_category_1_scores", "reading_reporting_category_2_scores", "reading_reporting_category_3_scores", "opportunity_key_mathematics", "opportunity_key_social_studies", "opportunity_key_science", "meets_grade_level_in_reading", "approaches_grade_level_in_reading", "masters_grade_level_in_reading", "score_code_reading", "opportunity_key_reading"]
            input_params:
              - env_var: "API_YEAR"
                hardwire_value: "2022"
          - display_name: "(2023 or later)"
            input_files:
              - env_var: "INPUT_FILE"
                required_cols: ["mathematics_reporting_category_1_scores", "mathematics_reporting_category_2_scores", "mathematics_reporting_category_3_scores", "mathematics_reporting_category_4_scores", "social_studies_reporting_category_1_scores", "social_studies_reporting_category_2_scores", "social_studies_reporting_category_3_scores", "social_studies_reporting_category_4_scores", "science_reporting_category_1_scores", "science_reporting_category_2_scores", "science_reporting_category_3_scores", "science_reporting_category_4_scores", "reading_language_arts_reporting_category_1_scores","reading_language_arts_reporting_category_2_scores", "reading_language_arts_raw_score", "reading_language_arts_scale_score", "reading_language_arts_test_version", "reading_language_arts_test_language_version", "meets_grade_level_in_reading_language_arts", "approaches_grade_level_in_reading_language_arts", "masters_grade_level_in_reading_language_arts", "score_code_reading_language_arts", "opportunity_key_reading_language_arts", "opportunity_key_mathematics", "opportunity_key_social_studies", "opportunity_key_science"]
      - display_name: "Alternate"
        input_files:
          - env_var: "INPUT_FILE"
            required_cols: ["grade_level_code", "level_ii__satisfactory_academic_performance_in_mathematics", "level_ii__satisfactory_academic_performance_in_social_studies", "level_ii__satisfactory_academic_performance_in_science", "level_iii__accomplished_academic_performance_in_mathematics", "level_iii__accomplished_academic_performance_in_social_studies", "level_iii__accomplished_academic_performance_in_science", "score_code_mathematics", "score_code_social_studies", "score_code_science"]
        input_params:
          - env_var: "FORMAT"
            hardwire_value: "Alt"
        assessments:
          - display_name: "(2021 and earlier)"
            input_files:
              - env_var: "INPUT_FILE"
                required_cols: ["level_ii__satisfactory_academic_performance_in_reading", "level_iii__accomplished_academic_performance_in_reading", "score_code_reading", "reading_reporting_category_scores", "mathematics_reporting_category_scores", "social_studies_reporting_category_scores", "science_reporting_category_scores", "writing_reporting_category_scores", "writing_raw_score", "writing_scale_score", "writing_test_version", "level_ii__satisfactory_academic_performance_in_writing", "level_iii__accomplished_academic_performance_in_writing"]
          - display_name: "(2022)"
            input_files: 
            - env_var: "INPUT_FILE"
              required_cols: ["level_ii__satisfactory_academic_performance_in_reading", "level_iii__accomplished_academic_performance_in_reading", "score_code_reading", "opportunity_key_mathematics", "opportunity_key_social_studies", "opportunity_key_science", "opportunity_key_reading", "reading_reporting_category_1scores", "reading_reporting_category_2scores", "reading_reporting_category_3scores", "mathematics_reporting_categoryscores_1", "mathematics_reading_reportingcategory_2_scores", "mathematics_reading_reportingcategory_3_scores", "mathematics_reading_reportingcategory_4_scores", "social_studies_reporting_categoryscores_1", "social_studies_reporting_categoryscores_2", "social_studies_reporting_categoryscores_3", "social_studies_reporting_categoryscores_4", "science_reporting_category_1scores", "science_reporting_category_2scores", "science_reporting_category_3scores", "science_reporting_category_4scores"]
            input_params:
            - env_var: "API_YEAR"
              hardwire_value: "2022"
          - display_name: "(2023 or later)"
            input_files:
            - env_var: "INPUT_FILE"
              required_cols: ["opportunity_key_mathematics", "opportunity_key_social_studies", "opportunity_key_science", "reading_language_arts_reportingcategory_1_scores", "reading_language_arts_reportingcategory_2_scores", "reading_language_arts_raw_score", "reading_language_arts_scale_score", "reading_language_arts_test_version", "level_ii__satisfactory_academic_performance_in_reading_languagearts", "level_iii__accomplished_academic_performance_in_reading_languagearts", "score_code_reading_language_arts", "opportunity_key_readinglanguage_arts", "mathematics_reporting_category_1scores", "mathematics_reporting_category_2scores", "mathematics_reporting_category_3scores", "mathematics_reporting_category_4scores", "social_studies_reporting_category_1scores", "social_studies_reporting_category_2scores", "social_studies_reporting_category_3scores", "social_studies_reporting_category_4scores", "science_reporting_category_1scores", "science_reporting_category_2scores", "science_reporting_category_3scores", "science_reporting_category_4scores"]
  - display_name: "End-of-Course"
    input_files:
      - env_var: "INPUT_FILE"
        required_cols: ["grade_level_code", "administration_date", "end_of_course_code"]
    assessments:
      - display_name: ""
        input_files:
          - env_var: "INPUT_FILE"
            required_cols: ["masters_grade_level", "meets_grade_level", "approaches_grade_level_at_the_students_standard"]
        input_params:
          - env_var: "FORMAT"
            hardwire_value: "EOC"
        assessments:
          - display_name: "(2021 and earlier)"
            input_files:
              - env_var: "INPUT_FILE"
                required_cols: ["document_number", "reporting_category_scores"]
          - display_name: "(2022)"
            input_files: 
              - env_var: "INPUT_FILE"
                required_cols: ["opportunity_key", "reporting_category_1_raw_score", "reporting_category_2_raw_score", "reporting_category_3_raw_score", "reporting_category_4_raw_score", "reporting_category_5_raw_score", "reporting_category_6_raw_score"]
            input_params:
              - env_var: "API_YEAR"
                hardwire_value: "2022"
          - display_name: "(2023 or later)"
            input_files:
              - env_var: "INPUT_FILE"
                required_cols: ["opportunity_key", "reporting_category_1_raw_score", "reporting_category_2_raw_score", "reporting_category_3_raw_score", "reporting_category_4_raw_score", "reporting_category_5_raw_score"]
      - display_name: "Alternate"
        input_files:
          - env_var: "INPUT_FILE"
            required_cols: ["level_iii__accomplished_academic_performance", "level_ii__satisfactory_academic_performance"]
        input_params:
          - env_var: "FORMAT"
            hardwire_value: "EOC-Alt"
        assessments: # same requirements as regular eoc
          - display_name: "(2021 and earlier)"
            input_files:
              - env_var: "INPUT_FILE"
                required_cols: ["document_number", "reporting_category_scores"]
          - display_name: "(2022)"
            input_files: 
              - env_var: "INPUT_FILE"
                required_cols: ["opportunity_key", "reporting_category_1_raw_score", "reporting_category_2_raw_score", "reporting_category_3_raw_score", "reporting_category_4_raw_score", "reporting_category_5_raw_score", "reporting_category_6_raw_score"]
            input_params:
              - env_var: "API_YEAR"
                hardwire_value: "2022"
          - display_name: "(2023 or later)"
            input_files:
              - env_var: "INPUT_FILE"
                required_cols: ["opportunity_key", "reporting_category_1_raw_score", "reporting_category_2_raw_score", "reporting_category_3_raw_score", "reporting_category_4_raw_score", "reporting_category_5_raw_score"]