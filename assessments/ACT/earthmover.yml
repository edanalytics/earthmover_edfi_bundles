version: 2


config:
  log_level: DEBUG
  output_dir: ${OUTPUT_DIR}
  state_file: ${STATE_FILE}
  show_graph: True
  show_stacktrace: True
  parameter_defaults:
    STUDENT_ID_NAME: ''
    STUDENT_ID_FROM: ''
    STUDENT_ID_XWALK: ''
    STUDENT_ID_QUERY: ''
    DATABASE_CONNECTION: ''


sources:
  results_file:
    file: ${INPUT_FILE}
    header_rows: 1
  assessments:
    file: ./seeds/assessments.csv
    header_rows: 1
  assessmentReportingMethodDescriptors:
    file: ./seeds/assessmentReportingMethodDescriptors.csv
    header_rows: 1
  objectiveAssessments:
    file: ./seeds/objectiveAssessments.csv
    header_rows: 1
  {% if "${STUDENT_ID_QUERY}" | length %}
  student_id_mapping:
    connection: ${DATABASE_CONNECTION}
    query: ${STUDENT_ID_QUERY}

  {% else %}
  student_id_mapping:
    file: ${STUDENT_ID_XWALK}
    header_rows: 1
    columns: 
      - student_id_from 
      - student_id_to
    optional: True 
  {% endif %}


transformations:
  act_student_assessment:
    source: $sources.act_input
    operations:
      - operation: keep_columns
        columns: 
        # Generic fields
        - ID_StateAssign
        - ID_Local
        - HS_GradeLev
        - Test_Dte
        - Test_Loc

        # Scores
        - Composite
        - Sum_Scale
        - StRnk_Comp
        - USRnk_Comp
        - Sup_Composite
        - Sup_Sum_Scale

        # ELA specific scores
        - ELA
        - StRnk_ELA
        - USRnk_ELA
        - Sup_ELA

        # English specific scores  
        - Eng
        - StRnk_Eng
        - USRnk_Eng
        - Sup_Eng_Sc

        # Math specific scores
        - Mth
        - StRnk_Math
        - USRnk_Math
        - Sup_Mth_Sc

        # Reading specific scores 
        - Rdg
        - StRnk_Read
        - USRnk_Read
        - R_CmplxTxt
        - Sup_Rdg_Sc

        # Science specific scores
        - Sci
        - StRnk_Sci
        - USRnk_Sci
        - Sup_Sci_Sc

        # STEM specific scores
        - STEM
        - StRnk_STEM
        - USRnk_STEM
        - Sup_STEM

        # Writing specific scores
        - Writing
        - StRnk_W
        - W_USRnk
        - W_Dom_Ideas
        - W_Dom_Supt
        - W_Dom_Org
        - W_Dom_LangUs
        - Sup_Writ_Sc


destinations:
  assessments:
    source: $sources.assessments
    template: ./templates/assessments.jsont
    extension: jsonl
  assessmentReportingMethodDescriptors:
    source: $sources.assessmentReportingMethodDescriptors
    template: ./templates/assessmentReportingMethodDescriptors.jsont
    extension: jsonl
  performanceLevelDescriptors:
    source: $sources.performanceLevelDescriptors
    template: ./templates/performanceLevelDescriptors.jsont
    extension: jsonl
  objectiveAssessments:
    source: $sources.objectiveAssessments
    template: ./templates/objectiveAssessments.jsont
    extension: jsonl
  studentAssessments:
    source: $transformations.clean_results
    template: ./templates/studentAssessments.jsont
    extension: jsonl